<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Haakon Bakka" />


<title>The Barrier model applied to the Archipelago data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="hcstyle.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="organisedtopics.html">Organised Topics</a>
</li>
<li>
  <a href="alltopics.html">All Topics</a>
</li>
<li>
  <a href="aboutme.html">About me</a>
</li>
<li>
  <a href="feedback.html">Feedback</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">The Barrier model applied to the Archipelago data</h1>
<h4 class="author">Haakon Bakka</h4>
<h4 class="date">BTopic107 updated 01. February 2018</h4>

</div>



<div id="about" class="section level1">
<h1><span class="header-section-number">1</span> About</h1>
<p>This topic covers how to visualize spatial models near a coast. The method for visualizing spatial models can be used for other models. The knowledge we gain on the spatial models we are looking at is useful when using these models.</p>
<div id="initialisation-and-dependency" class="section level2">
<h2><span class="header-section-number">1.1</span> Initialisation and dependency</h2>
<p>We load the libraries and functions we need. You may need to install these libraries (<a href="btopic109.html">Installation and general troubleshooting</a>). Feel free to save the web location where the data is as an R-file on your computer. We also set random seeds to be used later.</p>
<pre class="r"><code>library(INLA); library(fields)
library(rgeos)
library(viridisLite)

set.seed(2016)
set.inla.seed = 2016</code></pre>
</div>
<div id="data" class="section level2">
<h2><span class="header-section-number">1.2</span> Data</h2>
<div id="download-data" class="section level3">
<h3><span class="header-section-number">1.2.1</span> Download data</h3>
<p>An internet connection is required, unless you have already downloaded the repository.</p>
<pre><code>dir.create(&quot;data/&quot;)
download.file(url = &quot;https://haakonbakkagit.github.io/data/WebSiteData-Archipelago.RData&quot;, destfile = &quot;data/WebSiteData-Archipelago.RData&quot;)</code></pre>
</div>
<div id="load-data" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Load data</h3>
<pre class="r"><code>## Load data
load(file = &quot;data/WebSiteData-Archipelago.RData&quot;)
# - if you have saved the file locally

## What is loaded
# - poly.water is our study area
# - df is our dataframe to be analysed
# - dat is the orginial dataframe
str(poly.water, 1)</code></pre>
<pre><code>## Formal class &#39;SpatialPolygons&#39; [package &quot;sp&quot;] with 4 slots</code></pre>
</div>
<div id="data-citations" class="section level3">
<h3><span class="header-section-number">1.2.3</span> Data citations</h3>
<p>For a description of the data see <span class="citation">(Kallasvuo, Vanhatalo, and Veneranta 2016)</span>. Data collection was funded by VELMU and Natural Resources Institute Finland (Luke).</p>
</div>
</div>
</div>
<div id="generic-model-setup" class="section level1">
<h1><span class="header-section-number">2</span> Generic model setup</h1>
<p>We choose one of the four fish species to model, the smelt</p>
<pre class="r"><code>df$y = df$y.smelt</code></pre>
<p>To keep track of our models, we define a list containing all the models.</p>
<pre class="r"><code>M = list()
# - the list of all models
M[[1]] = list()
# - the first model
M[[1]]$shortname = &quot;stationary-no-cov&quot;
# - a short description, the name of the model
M[[2]] = list()
M[[2]]$shortname = &quot;stationary-all-cov&quot;
M[[3]] = list()
M[[3]]$shortname = &quot;barrier-no-cov&quot;
M[[4]] = list()
M[[4]]$shortname = &quot;barrier-all-cov&quot;</code></pre>
<div id="the-mesh-dependency-btopic104" class="section level2">
<h2><span class="header-section-number">2.1</span> The mesh: Dependency <a href="btopic104.html">BTopic104</a></h2>
<p>The following code is from the dependency. The <code>mesh</code> we are using was called <code>mesh4</code> in BTopic104. You probably want to read this dependency topic.</p>
<p>We had to adjust max.edge. When running with <code>max.edge=0.95</code> we got ranges near 3. As we mentioned in BTopic104, the max.edge must be at most ca range/5.</p>
<pre class="r"><code>max.edge = 0.6
bound.outer = 4.6
mesh = inla.mesh.2d(boundary = poly.water,
                     loc=cbind(df$locx, df$locy),
                    max.edge = c(1,5)*max.edge,
                    cutoff = 0.06,
                    offset = c(max.edge, bound.outer))
plot(mesh, main=&quot;Our mesh&quot;, lwd=0.5); points(df$locx, df$locy, col=&quot;red&quot;)</code></pre>
<p><img src="btopic107_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>mesh$n</code></pre>
<pre><code>## [1] 6539</code></pre>
</div>
<div id="the-stack" class="section level2">
<h2><span class="header-section-number">2.2</span> The stack</h2>
<p>To connect the observations <span class="math inline">\(y_i\)</span> (at locations <span class="math inline">\(s_i\)</span>) to the mesh nodes <code>s</code>, we have the so-called A-matrix.</p>
<pre class="r"><code>A.i.s = inla.spde.make.A(mesh, loc=cbind(df$locx, df$locy))</code></pre>
<p>Next we set up the stack, needed for all spatial models in INLA.</p>
<pre class="r"><code> stk &lt;- inla.stack(data=list(y=df$y, e=df$exposure), 
                    effects=list(s=1:mesh$n,
                                 data.frame(m=1, df[ ,5:11]), 
                                 # - m is the intercept
                                 iidx=1:nrow(df)),
                   A=list(A.i.s, 1, 1),
                    remove.unused = FALSE, tag=&#39;est&#39;)  </code></pre>
</div>
</div>
<div id="stationary-models" class="section level1">
<h1><span class="header-section-number">3</span> Stationary models</h1>
<p>To set up the stationary spatial model, we first define the spatial Model Component.</p>
<pre class="r"><code>spde = inla.spde2.pcmatern(mesh, prior.range = c(6, .5), prior.sigma = c(3, 0.01))
# - We put the prior median at approximately 0.5*diff(range(df$locy))
# - - this is roughly the extent of our study area
# - The prior probability of marginal standard deviation 3 or more is 0.01.</code></pre>
<p>Then we define the two formulas.</p>
<pre class="r"><code>hyper.iid = list(prec = list(prior = &#39;pc.prec&#39;, param = c(3, 0.01))) 
# - the param the same as prior.sigma above, with the same interpretation
M[[1]]$formula = y~ -1+m + f(s, model=spde) + f(iidx, model=&quot;iid&quot;, hyper=hyper.iid)
# - no covariates (except intercept m)
M[[2]]$formula = as.formula(paste( &quot;y ~ -1 + &quot;,paste(colnames(df)[5:11], collapse = &quot; + &quot;)))
M[[2]]$formula = update(M[[2]]$formula, .~. +m + f(s, model=spde) + f(iidx, model=&quot;iid&quot;, hyper=hyper.iid))</code></pre>
<p>Let us check that our objects are correct.</p>
<pre class="r"><code>print(M[[1]])</code></pre>
<pre><code>## $shortname
## [1] &quot;stationary-no-cov&quot;
## 
## $formula
## y ~ -1 + m + f(s, model = spde) + f(iidx, model = &quot;iid&quot;, hyper = hyper.iid)</code></pre>
<pre class="r"><code>print(M[[2]])</code></pre>
<pre><code>## $shortname
## [1] &quot;stationary-all-cov&quot;
## 
## $formula
## y ~ dptLUKE + dptavg15km + dist30m + joetdsumsq + lined15km + 
##     swmlog10 + temjul15 + m + f(s, model = spde) + f(iidx, model = &quot;iid&quot;, 
##     hyper = hyper.iid) - 1</code></pre>
<p>We will not run the INLA calls until we have set up all the models.</p>
</div>
<div id="barrier-models" class="section level1">
<h1><span class="header-section-number">4</span> Barrier models</h1>
<p>First we divide up the mesh accoring to our study area polygon.</p>
<pre class="r"><code>tl = length(mesh$graph$tv[,1])
# - the number of triangles in the mesh
posTri = matrix(0, tl, 2)
for (t in 1:tl){
  temp = mesh$loc[mesh$graph$tv[t, ], ]
  posTri[t,] = colMeans(temp)[c(1,2)] 
}
posTri = SpatialPoints(posTri)

# - compute the triangle positions
normal = over(poly.water, posTri, returnList=T)
# - checking which mesh triangles are inside the normal area
normal = unlist(normal)
barrier.triangles = setdiff(1:tl, normal)

poly.barrier = inla.barrier.polygon(mesh, barrier.triangles)</code></pre>
<pre><code>## Warning in RGEOSUnaryPredFunc(spgeom, byid, &quot;rgeos_isvalid&quot;): Self-
## intersection at or near point 0 0</code></pre>
<pre><code>## mesh.polys is invalid</code></pre>
<pre><code>## Warning in rgeos::gUnaryUnion(mesh.polys): Invalid objects found;
## consider using set_RGEOS_CheckValidity(2L)</code></pre>
<pre><code>## Warning in RGEOSUnaryPredFunc(spgeom, byid, &quot;rgeos_isvalid&quot;): Self-
## intersection at or near point -4.5999999999999996 -0.91499688999999995</code></pre>
<pre><code>## mesh.polys is invalid</code></pre>
<pre><code>## Warning in rgeos::gUnaryUnion(mesh.polys): Invalid objects found;
## consider using set_RGEOS_CheckValidity(2L)</code></pre>
<pre class="r"><code>barrier.model = inla.barrier.pcmatern(mesh, barrier.triangles = barrier.triangles, prior.range = c(6, .5), prior.sigma = c(3, 0.01))
# - this creates the INLA object for the model</code></pre>
<pre class="r"><code>M[[3]]$formula = y~ -1+m + f(s, model=barrier.model) + f(iidx, model=&quot;iid&quot;, hyper=hyper.iid)
# - no covariates (except intercept m)
M[[4]]$formula = as.formula(paste( &quot;y ~ -1 + &quot;,paste(colnames(df)[5:11], collapse = &quot; + &quot;)))
M[[4]]$formula = update(M[[4]]$formula, .~. +m + f(s, model=barrier.model) + f(iidx, model=&quot;iid&quot;, hyper=hyper.iid))</code></pre>
<p>Then we check</p>
<pre class="r"><code>print(M[[3]])</code></pre>
<pre><code>## $shortname
## [1] &quot;barrier-no-cov&quot;
## 
## $formula
## y ~ -1 + m + f(s, model = barrier.model) + f(iidx, model = &quot;iid&quot;, 
##     hyper = hyper.iid)</code></pre>
<pre class="r"><code>print(M[[4]])</code></pre>
<pre><code>## $shortname
## [1] &quot;barrier-all-cov&quot;
## 
## $formula
## y ~ dptLUKE + dptavg15km + dist30m + joetdsumsq + lined15km + 
##     swmlog10 + temjul15 + m + f(s, model = barrier.model) + f(iidx, 
##     model = &quot;iid&quot;, hyper = hyper.iid) - 1</code></pre>
<div id="plot-data" class="section level2">
<h2><span class="header-section-number">4.1</span> Plot data</h2>
<p>Now that we have a polygon for representing the land area (physical barrier), we plot the data locations.</p>
<pre class="r"><code>par(mar=rep(.1, 4))
plot(df$locx, y=df$locy, pch=20, asp=1)
plot(poly.barrier, add=T, border=&quot;black&quot;, col=&quot;grey&quot;)</code></pre>
<p><img src="btopic107_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
</div>
<div id="running-all-the-models" class="section level1">
<h1><span class="header-section-number">5</span> Running all the models</h1>
<p>Set up the initial values.</p>
<pre class="r"><code>## Initial values
# - speeds up computations
# - improves accuracy of computations
# - set these to NULL the first time you run the model
M[[1]]$init = c(2.509,1.199,-0.574)
M[[2]]$init = c(1.162,0.313,-0.627)
M[[3]]$init = c(0.833,2.244,-0.471)
M[[4]]$init = c(0.044,1.274,-0.596)</code></pre>
<p>Next, we run the inference for the our models, which can take some time.</p>
<pre class="r"><code>for (i in 1:length(M)){
    print(paste(&quot;Running:  &quot;, M[[i]]$shortname))
    M[[i]]$res = inla(M[[i]]$formula,
                      data=inla.stack.data(stk),
                      control.predictor=list(A=inla.stack.A(stk)),
                      family=&quot;poisson&quot;, E = e,
                      control.inla= list(int.strategy = &quot;eb&quot;),
                      control.mode=list(restart=T, theta=M[[i]]$init))  
}</code></pre>
<pre><code>## [1] &quot;Running:   stationary-no-cov&quot;
## [1] &quot;Running:   stationary-all-cov&quot;
## [1] &quot;Running:   barrier-no-cov&quot;
## [1] &quot;Running:   barrier-all-cov&quot;</code></pre>
<pre class="r"><code># - time: &lt; 20 min</code></pre>
<p>The initial values that we set <code>M[[i]]$init</code>:</p>
<pre class="r"><code>for (i in 1:length(M)){
  print(paste(round(M[[i]]$res$internal.summary.hyperpar$mode, 3), collapse = &#39;,&#39;))
}</code></pre>
<pre><code>## [1] &quot;2.509,1.199,-0.574&quot;
## [1] &quot;1.144,0.314,-0.62&quot;
## [1] &quot;0.787,2.339,-0.471&quot;
## [1] &quot;-0.002,1.29,-0.581&quot;</code></pre>
<div id="summaries" class="section level2">
<h2><span class="header-section-number">5.1</span> Summaries</h2>
<p>You can run these to see the model output.</p>
<pre class="r"><code>#summary(M[[1]]$res)
#summary(M[[2]]$res)
#summary(M[[3]]$res)
#summary(M[[4]]$res)</code></pre>
</div>
<div id="logfiles" class="section level2">
<h2><span class="header-section-number">5.2</span> Logfiles</h2>
<p>To understand how well the computations of the posterior worked, we look at the logfiles.</p>
<pre class="r"><code>#M[[i]]$res$logfile</code></pre>
<p>Discussing INLA inference in detail is out of scope of this topic. What we conclude from this is that the posteriors for the models without covariates are nicely behaved, and INLA is very successful. For the models with covariates, the posterior is a bit flat, and INLA is having a bit of difficulty. However, it is still sufficiently good.</p>
</div>
</div>
<div id="plot-posterior-spatial-fields" class="section level1">
<h1><span class="header-section-number">6</span> Plot posterior spatial fields</h1>
<div id="define-the-plotting-function-btopic103" class="section level2">
<h2><span class="header-section-number">6.1</span> Define the plotting function <a href="btopic103.html">BTopic103</a></h2>
<pre class="r"><code>local.plot.field = function(field, mesh, xlim, ylim, ...){
  stopifnot(length(field) == mesh$n)
  # - error when using the wrong mesh
  if (missing(xlim)) xlim = poly.water@bbox[1, ] 
  if (missing(ylim)) ylim = poly.water@bbox[2, ]
  # - choose plotting region to be the same as the study area polygon
  proj = inla.mesh.projector(mesh, xlim = xlim, 
                             ylim = ylim, dims=c(300, 300))
  # - Can project from the mesh onto a 300x300 grid 
  #   for plots
  field.proj = inla.mesh.project(proj, field)
  # - Do the projection
  image.plot(list(x = proj$x, y=proj$y, z = field.proj), 
             xlim = xlim, ylim = ylim, col = plasma(17), ...)  
}</code></pre>
</div>
<div id="plot-the-models-without-covariates" class="section level2">
<h2><span class="header-section-number">6.2</span> Plot the models without covariates</h2>
<pre class="r"><code>for (i in c(1,3)) {
  field = M[[i]]$res$summary.random$s$mean + M[[i]]$res$summary.fixed[&#39;m&#39;, &#39;mean&#39;]
  local.plot.field(field, mesh, main=paste(M[[i]]$shortname), zlim=c(-10.5, 1))
  plot(poly.barrier, add=T, col=&quot;grey&quot;)
  points(df$locx, df$locy)
}</code></pre>
<p><img src="btopic107_files/figure-html/unnamed-chunk-22-1.png" width="672" /><img src="btopic107_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
</div>
<div id="plot-the-models-with-covariates" class="section level2">
<h2><span class="header-section-number">6.3</span> Plot the models with covariates</h2>
<pre class="r"><code>for (i in c(2,4)) {
  field = M[[i]]$res$summary.random$s$mean + M[[i]]$res$summary.fixed[&#39;m&#39;, &#39;mean&#39;]
  local.plot.field(field, mesh, main=paste(M[[i]]$shortname), zlim=c(-9, -4.5))
  plot(poly.barrier, add=T, col=&quot;grey&quot;)
  points(df$locx, df$locy)
}</code></pre>
<p><img src="btopic107_files/figure-html/unnamed-chunk-23-1.png" width="672" /><img src="btopic107_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
</div>
</div>
<div id="compare-fixed-effects" class="section level1">
<h1><span class="header-section-number">7</span> Compare fixed effects</h1>
<p>Do a nice <code>ggplot</code> of the fixed effects between the spatial models with covariates.</p>
<pre class="r"><code>## Set up dataframe with relevant results
res = M[[2]]$res$summary.fixed[ ,c(4,3,5)]
# - all covar, some quantiles
for(i in c(4)) res = rbind(res, M[[i]]$res$summary.fixed[ ,c(4,3,5)])

colnames(res) = c(&quot;E&quot;, &quot;L&quot;, &quot;U&quot;)
rownames(res)=NULL
n.covar = nrow(M[[2]]$res$summary.fixed)
res$model = factor(rep(c(&quot;MS&quot;, &quot;MB&quot;), each=n.covar, 
                   levels = c(&quot;MS&quot;, &quot;MB&quot;)))
res$covar = factor(rep(rownames(M[[2]]$res$summary.fixed), 2))

if(require(ggplot2)) {
  ggplot(res, aes(x = model, y = E)) +
    facet_wrap(~covar, scales = &quot;free_y&quot;) +
    geom_point(size = 3) +
    geom_errorbar(aes(ymax = U, ymin = L)) +
    xlab(NULL) + ylab(NULL) 
}</code></pre>
<p><img src="btopic107_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="comments" class="section level1">
<h1><span class="header-section-number">8</span> Comments</h1>
<p>This analysis is done in more detail in the paper <span class="citation">(Bakka et al. 2016)</span>.</p>
<div id="related-topics" class="section level2">
<h2><span class="header-section-number">8.1</span> Related topics</h2>
<p><a href="btopic105.html">BTopic105</a> and <a href="btopic103.html">BTopic103</a> are relevant to the current topic.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-tech125">
<p>Bakka, H., J. Vanhatalo, J. Illian, D. Simpson, and H. Rue. 2016. “Accounting for Physical Barriers in Species Distribution Modeling with Non-Stationary Spatial Random Effects.” ArXiv preprint arXiv:1608.03787. Norwegian University of Science; Technology, Trondheim, Norway.</p>
</div>
<div id="ref-kallasvuo2016modeling">
<p>Kallasvuo, Meri, Jarno Vanhatalo, and Lari Veneranta. 2016. “Modeling the Spatial Distribution of Larval Fish Abundance Provides Essential Information for Management.” <em>Canadian Journal of Fisheries and Aquatic Sciences</em>, no. ja. NRC Research Press.</p>
</div>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
